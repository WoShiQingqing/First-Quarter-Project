# syntax=docker/dockerfile:1

# æ„å»ºå±‚
FROM golang:1.22 AS build
WORKDIR /src
COPY . .
# äº¤å‰ç¼–è¯‘ï¼ˆè‹¥èµ° buildxï¼Œé€šå¸¸ä¼šæ³¨å…¥ TARGETOS/TARGETARCHï¼‰
ARG TARGETOS TARGETARCH
RUN GOOS=${TARGETOS:-linux} GOARCH=${TARGETARCH:-amd64} CGO_ENABLED=0 \
    go build -o /out/worker ./W2/cloudnative-jobflow/worker

# è¿è¡Œå±‚ï¼ˆdistroless æˆ– scratch éƒ½å¯ï¼›ä¸‹é¢ç”¨ distroless ä½œä¸ºä¾‹ï¼‰
FROM gcr.io/distroless/static:nonroot
WORKDIR /app
COPY --from=build /out/worker /app/worker
USER nonroot:nonroot
# ğŸ‘‡ ä¸€å®šè¦æœ‰
ENTRYPOINT ["/app/worker"]
# å¯é€‰ï¼šè‹¥ä½ å¸Œæœ›é»˜è®¤æ‰“å°å¸®åŠ©
# CMD ["--help"]
